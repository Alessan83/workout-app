<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Workout 100</title>

<style>
:root{
  --bg:#0f1115; 
  --panel:#151924; 
  --text:#e8e8e8; 
  --muted:#a8b0c0; 
  --line:#2a3142;
  --accent:#4da6ff; 
  --ok:#25d366; 
  --warn:#f5c542; 
}

body{
  font-family:Arial,system-ui;
  background:var(--bg);
  color:var(--text);
  margin:0;
  padding:14px;
}

.card{
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:10px;
  padding:10px;
  margin:10px auto;
  max-width:900px;
}

.exercise{
  border:1px solid var(--line);
  border-radius:10px;
  padding:10px;
  margin:8px 0;
  background:#0b0d12;
}

button,select{
  border:1px solid var(--line);
  background:#0b0d12;
  color:var(--text);
  border-radius:8px;
  padding:8px;
}

.sectionTitle{
  margin:14px 0 6px;
  font-weight:700;
}

.cues{
  font-size:13px;
  color:var(--muted);
  margin-top:6px;
}

@media(max-width:600px){
  select,button{width:100%;margin-top:6px}
}
</style>
</head>
<body>

<h2>Workout 100</h2>

<div class="card">
  <div>
    Durata:
    <select id="mode">
      <option value="25">25 minuti</option>
      <option value="35">35 minuti</option>
    </select>
  </div>

  <div style="margin-top:10px">
    RPE finale:
    <select id="rpe">
      <option value="1">1 = facile</option>
      <option value="2" selected>2 = ok</option>
      <option value="3">3 = duro</option>
    </select>
  </div>

  <div style="margin-top:10px">
    <button onclick="generate()">Genera sessione</button>
    <button onclick="complete()">Allenamento completato</button>
  </div>

  <div id="status" style="margin-top:10px;font-size:12px;color:var(--muted)"></div>
</div>

<div class="card" id="program"></div>

<div class="card">
  <pre id="log" style="font-size:11px;color:var(--muted)"></pre>
</div>

<script src="exercises.js"></script>
<script src="trainingKnowledge.js"></script>
<script src="biomechanicalEngine.js"></script>
<script src="studyEngine.js"></script>
<script src="sessionengine1.js"></script>

<script>

let currentSession = null;

function today(){
  return new Date().toISOString().split("T")[0];
}

function generate(){

  const minutes = parseInt(document.getElementById("mode").value,10);

  if(!window.SessionEngine){
    alert("SessionEngine non caricato");
    return;
  }

  currentSession = SessionEngine.generateSession(exerciseDB,{
    sessionMinutes: minutes
  });

  render(currentSession);

  document.getElementById("status").innerText =
    "Sessione generata per oggi: " + today();
}

function render(session){

  const container = document.getElementById("program");
  container.innerHTML = "";

  if(!session) return;

  renderBlock("Riscaldamento",session.warm,container);
  renderBlock("Mobilità",session.mobility,container);
  renderBlock("Forza",session.strength,container,true);
}

function renderBlock(title,list,container,isStrength=false){

  if(!list || !list.length) return;

  container.innerHTML += `<div class="sectionTitle">${title}</div>`;

  list.forEach(ex=>{

    const cues = collectCues(ex);

    let html = `<div class="exercise">
      <b>${ex.name}</b>`;

    if(isStrength && ex.prescription){
      html += `<div>Rx: ${ex.prescription.cycles || "-"} cicli × ${ex.prescription.reps || "-"} reps</div>`;
      if(ex.prescription.band)
        html += `<div>Banda: ${ex.prescription.band}</div>`;
    }

    if(cues.length){
      html += `<div class="cues">${cues.join("<br>")}</div>`;
    }

    html += `</div>`;

    container.innerHTML += html;
  });
}

function collectCues(ex){

  let cues = [];

  try{
    if(window.BiomechanicalEngine && BiomechanicalEngine.getCues){
      cues = cues.concat(BiomechanicalEngine.getCues(ex) || []);
    }
  }catch(e){}

  try{
    if(window.StudyEngine && StudyEngine.getCues){
      cues = cues.concat(StudyEngine.getCues(ex) || []);
    }
  }catch(e){}

  if(ex.cues) cues = cues.concat(ex.cues);

  return [...new Set(cues)];
}

function complete(){

  if(!currentSession){
    alert("Nessuna sessione generata");
    return;
  }

  const rpe = parseInt(document.getElementById("rpe").value,10);

  const payload = {
    date: today(),
    session: currentSession,
    rpe: rpe
  };

  try{
    if(window.StudyEngine && StudyEngine.completeSession)
      StudyEngine.completeSession(payload);
  }catch(e){}

  try{
    if(window.BiomechanicalEngine && BiomechanicalEngine.completeSession)
      BiomechanicalEngine.completeSession(payload);
  }catch(e){}

  try{
    if(window.SessionEngine && SessionEngine.completeSession)
      SessionEngine.completeSession(payload);
  }catch(e){}

  document.getElementById("log").innerText =
    JSON.stringify(payload,null,2);

  alert("Sessione salvata");
}

</script>
</body>
</html>
