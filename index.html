<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Workout 100</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#111;color:#eee;padding:15px;text-align:center}
button{padding:8px;margin:6px;background:#222;color:#eee;border:1px solid #444}
select{background:#222;color:#eee;border:1px solid #444;padding:5px}
.section{margin:18px 0;font-weight:bold;font-size:16px}
.exercise{border:1px solid #333;padding:10px;margin:8px 0;text-align:left}
a{color:#4da6ff;text-decoration:none}
.small{font-size:12px;color:#aaa}
.pill{display:inline-block;border:1px solid #333;padding:4px 8px;margin:4px;background:#151515}
.square{width:14px;height:14px;border:1px solid #444;display:inline-block;margin-right:6px;vertical-align:middle}
.done{background:#2a7a2a}
hr{border:0;border-top:1px solid #333;margin:14px 0}
</style>
</head>
<body>

<h2>Workout 100</h2>

<div class="pill">
  <select id="mode" onchange="generateWorkout()">
    <option value="25">25 minuti</option>
    <option value="35">35 minuti</option>
  </select>
</div>

<div>
  <span id="doneSquare" class="square"></span>
  <span class="pill">Streak: <span id="streak">0</span></span>
  <span class="pill">Allenamenti totali: <span id="totalW">0</span></span>
</div>

<hr>

<div id="program"></div>

<hr>

<div>
  <div class="pill">Fase: <b id="phase">—</b></div>
  <div class="pill">Tempo: <b id="timeLeft">—</b></div>
</div>

<div style="margin-top:10px">
  <button onclick="startSession()">Start</button>
  <button onclick="nextPhase()">Next</button>
</div>

<div style="margin-top:10px">
  <button onclick="completeWorkout()">Allenamento completato</button>
</div>

<script>

/* ===============================
   STORAGE E PARAMETRI PROGRESSIONE
================================= */

const STORE="workoutV8";

let data=JSON.parse(localStorage.getItem(STORE))||{
completedDate:null,
streak:0,
totalWorkouts:0
};

function save(){localStorage.setItem(STORE,JSON.stringify(data));}
function today(){return new Date().toISOString().split("T")[0];}

/* ===============================
   PROGRESSIONE AUTOMATICA
   - basata su numero allenamenti
   - ciclo settimanale 3-4 allenamenti
================================= */

function getProgression(){
let freq = data.totalWorkouts;
let weekBlock = Math.floor(freq / 4);

let repsBase = 10 + weekBlock*2;
repsBase = Math.min(repsBase,18);

let band;
if(freq < 4) band=15;
else if(freq < 12) band=25;
else band=35;

return {reps:repsBase, band:band};
}

/* ===============================
   DATABASE ESERCIZI CON NOTE TECNICHE
================================= */

const DB={
warm:[
{n:"Jumping Jacks",note:"Atterra morbido. Core leggermente attivo."},
{n:"Inchworm",note:"Non iperestendere zona lombare."},
{n:"Arm Circles",note:"Controllo scapolare attivo."}
],
mobility:[
{n:"Thoracic Rotation",note:"Muovi solo dorsale, bacino stabile."},
{n:"Hip CARs",note:"Movimento lento e controllato."}
],
training:[
{n:"Band Row",note:"Spalle basse. Gomiti vicino al corpo."},
{n:"Push-up",note:"Core attivo, bacino neutro."},
{n:"Banded Deadlift",note:"Spingi con glutei, schiena neutra."},
{n:"Band Overhead Press",note:"Non inarcare la zona lombare."},
{n:"Single-Leg RDL",note:"Equilibrio e controllo caviglia."},
{n:"Band Face Pull",note:"Tira verso il viso, scapole chiuse."}
],
stretch:[
{n:"Child Pose",note:"Respirazione lenta."},
{n:"Hip Flexor Stretch",note:"Retroversione bacino."}
]
};

/* ===============================
   RANDOM STABILE PER GIORNO
================================= */

function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return ((t^t>>>14)>>>0)/4294967296;}}
function seedFromDate(str){let n=0;for(let i=0;i<str.length;i++)n=(n*31+str.charCodeAt(i))>>>0;return n;}

function pick(cat,count){
const rng=mulberry32(seedFromDate(today()+cat));
let arr=DB[cat].slice();
for(let i=arr.length-1;i>0;i--){
const j=Math.floor(rng()*(i+1));
[arr[i],arr[j]]=[arr[j],arr[i]];
}
return arr.slice(0,count);
}

/* ===============================
   RENDER PROGRAMMA
================================= */

function renderExercise(obj,extra){
return `<div class="exercise">
<b>${obj.n}</b><br>
${extra||""}
<div class="small">Nota: ${obj.note}</div>
</div>`;
}

function generateWorkout(){

document.getElementById("streak").innerText=data.streak;
document.getElementById("totalW").innerText=data.totalWorkouts;

if(data.completedDate===today())
document.getElementById("doneSquare").classList.add("done");
else
document.getElementById("doneSquare").classList.remove("done");

let mode=parseInt(document.getElementById("mode").value);
let prog=getProgression();

let container=document.getElementById("program");
container.innerHTML="";

/* Mobilità / Riscaldamento */
container.innerHTML+="<div class='section'>Mobilità / Riscaldamento</div>";
pick("warm",3).forEach(e=>container.innerHTML+=renderExercise(e));
pick("mobility",2).forEach(e=>container.innerHTML+=renderExercise(e));

/* Allenamento */
container.innerHTML+="<div class='section'>Allenamento</div>";

let trainingCount = (mode===25)?4:6;
let cycles = (mode===25)?2:3;

pick("training",trainingCount).forEach(e=>{
let extra=`Banda consigliata: <b>${prog.band}kg</b> | Ripetizioni: <b>${prog.reps}</b> | Cicli blocco: <b>${cycles}</b>`;
container.innerHTML+=renderExercise(e,extra);
});

/* Stretch */
container.innerHTML+="<div class='section'>Allungamento / Rilassamento</div>";
pick("stretch",1).forEach(e=>container.innerHTML+=renderExercise(e));

}

/* ===============================
   TIMER SEMPLICE
================================= */

let phases=[];
let current=0;
let timer=null;
let audioCtx=null;
let gainNode=null;

function initAudio(){
audioCtx=new(window.AudioContext||window.webkitAudioContext)();
gainNode=audioCtx.createGain();
gainNode.gain.value=0.01;
gainNode.connect(audioCtx.destination);
}

function beep(){
if(!audioCtx)initAudio();
let osc=audioCtx.createOscillator();
osc.frequency.value=500;
osc.connect(gainNode);
osc.start();
osc.stop(audioCtx.currentTime+0.04);
}

function buildPhases(){
let total=parseInt(document.getElementById("mode").value)*60;
let warm=Math.round(total*0.1);
let train=Math.round(total*0.75);
let relax=30;

phases=[
{name:"Riscaldamento",time:warm,beep:true},
{name:"Allenamento",time:train,beep:false},
{name:"Rilassamento 30s",time:relax,beep:true}
];
}

function startSession(){
buildPhases();
current=0;
runPhase();
}

function runPhase(){
if(timer)clearInterval(timer);
if(current>=phases.length){
document.getElementById("phase").innerText="Finito";
return;
}
let p=phases[current];
let t=p.time;
document.getElementById("phase").innerText=p.name;
timer=setInterval(()=>{
t--;
document.getElementById("timeLeft").innerText=t+" sec";
if(p.beep)beep();
if(t<=0){clearInterval(timer);current++;runPhase();}
},1000);
}

function nextPhase(){
clearInterval(timer);
current++;
runPhase();
}

/* ===============================
   COMPLETAMENTO
================================= */

function completeWorkout(){
if(data.completedDate===today())return;

data.completedDate=today();
data.streak++;
data.totalWorkouts++;
save();
generateWorkout();
alert("Allenamento registrato");
}

generateWorkout();

</script>
</body>
</html>
