<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Workout 100</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#111;color:#eee;padding:15px;text-align:center}
button{padding:8px;margin:6px;background:#222;color:#eee;border:1px solid #444}
select{background:#222;color:#eee;border:1px solid #444;padding:5px}
.section{margin:15px 0}
.exercise{border:1px solid #333;padding:8px;margin:6px 0}
a{color:#4da6ff;text-decoration:none}
</style>
</head>
<body>

<h2>Workout 100</h2>

<div>
Allenamento: <span id="workoutType"></span>
</div>

<div>
<select id="mode">
<option value="25">25 minuti</option>
<option value="35">35 minuti</option>
</select>
</div>

<div id="status"></div>

<div id="program"></div>

<div class="section">
<div id="phase"></div>
<div id="timeLeft"></div>
<button onclick="startPhase()">Start Fase</button>
<button onclick="nextPhase()">Fase Successiva</button>
</div>

<button onclick="completeWorkout()">Allenamento completato</button>

<script>

// ==========================
// DATABASE BASE
// ==========================

let data = JSON.parse(localStorage.getItem("workoutV4")) || {
startDate:new Date().toISOString().split("T")[0],
lastDate:null,
lastWorkout:0,
streak:0,
categories:{
pull:{band:15,time:40,streak:0},
push:{band:15,time:40,streak:0},
posterior:{band:25,time:40,streak:0}
}
};

const workouts={
1:["pull","push","posterior"],
2:["push","posterior","pull"],
3:["posterior","pull","push"]
};

const exerciseDB={
warm:["Jumping Jacks","High Knees","Arm Circles"],
mobility:["Hip CARs","Thoracic Rotation","Ankle Rock"],
core:["Plank","Dead Bug","Side Plank"],
stretch:["Child Pose","Hamstring Stretch","Hip Flexor Stretch"],
pull:["Band Row","Face Pull","High Row"],
push:["Push-up","Floor Press","Pike Push-up"],
posterior:["Deadlift","Glute Bridge","Good Morning"]
};

// ==========================
// ROTAZIONE GIORNALIERA
// ==========================

function today(){
return new Date().toISOString().split("T")[0];
}

function generateWorkout(){
if(data.lastDate!==today()){
data.lastWorkout = data.lastWorkout%3 +1;
data.lastDate=today();
localStorage.setItem("workoutV4",JSON.stringify(data));
}
document.getElementById("workoutType").innerText=data.lastWorkout;
renderProgram();
renderStatus();
}

// ==========================
// PROGRAMMA SESSIONE
// ==========================

let phases=[];
let currentPhaseIndex=0;
let timer;
let audioCtx;
let gainNode;

function buildPhases(){
let mode=document.getElementById("mode").value;
let warmTime=mode==="25"?120:180;
let mobilityTime=mode==="25"?120:180;
let blockTime=mode==="25"?300:420;
let coreTime=mode==="25"?120:180;
let stretchTime=mode==="25"?120:180;

phases=[];

phases.push({name:"Riscaldamento",time:warmTime,metronome:true});
phases.push({name:"MobilitÃ ",time:mobilityTime,metronome:false});

workouts[data.lastWorkout].forEach(cat=>{
phases.push({name:"Blocco "+cat,time:blockTime,metronome:true,category:cat});
});

phases.push({name:"Core",time:coreTime,metronome:true});
phases.push({name:"Stretch",time:30,metronome:true});
}

// ==========================
// RENDER PROGRAMMA
// ==========================

function renderProgram(){
let container=document.getElementById("program");
container.innerHTML="";

let warm = exerciseDB.warm.slice(0,2);
let mobility = exerciseDB.mobility.slice(0,2);
let core = exerciseDB.core.slice(0,1);
let stretch = exerciseDB.stretch.slice(0,1);

container.innerHTML+="<div class='section'><b>Riscaldamento</b></div>";
warm.forEach(ex=>{
container.innerHTML+=exerciseHTML(ex);
});

container.innerHTML+="<div class='section'><b>MobilitÃ </b></div>";
mobility.forEach(ex=>{
container.innerHTML+=exerciseHTML(ex);
});

workouts[data.lastWorkout].forEach(cat=>{
container.innerHTML+="<div class='section'><b>"+cat.toUpperCase()+"</b></div>";
let exList = exerciseDB[cat].slice(0,2);
exList.forEach(ex=>{
container.innerHTML+=exerciseHTML(ex,data.categories[cat]);
});
});

container.innerHTML+="<div class='section'><b>Core</b></div>";
core.forEach(ex=>{
container.innerHTML+=exerciseHTML(ex);
});

container.innerHTML+="<div class='section'><b>Stretch</b></div>";
stretch.forEach(ex=>{
container.innerHTML+=exerciseHTML(ex);
});
}

function exerciseHTML(name,catData){
let link="https://www.youtube.com/results?search_query="+encodeURIComponent(name+" exercise tutorial");
let extra="";
if(catData){
extra="Banda: "+catData.band+"kg | Tempo lavoro: "+catData.time+" sec";
}
return `
<div class="exercise">
<b>${name}</b><br>
${extra}<br>
<a href="${link}" target="_blank">Apri tutorial</a>
</div>`;
}

// ==========================
// TIMER + METRONOMO
// ==========================

function initAudio(){
audioCtx=new (window.AudioContext||window.webkitAudioContext)();
gainNode=audioCtx.createGain();
gainNode.gain.value=0.02;
gainNode.connect(audioCtx.destination);
}

function beep(){
let osc=audioCtx.createOscillator();
osc.type="sine";
osc.frequency.value=800;
osc.connect(gainNode);
osc.start();
osc.stop(audioCtx.currentTime+0.05);
}

function startPhase(){
if(!audioCtx) initAudio();
buildPhases();
runPhase();
}

function runPhase(){
if(currentPhaseIndex>=phases.length){
clearInterval(timer);
document.getElementById("phase").innerText="Sessione completata";
return;
}
let phase=phases[currentPhaseIndex];
let timeLeft=phase.time;
document.getElementById("phase").innerText=phase.name;

timer=setInterval(()=>{
timeLeft--;
document.getElementById("timeLeft").innerText=timeLeft+" sec";

if(phase.metronome) beep();

if(timeLeft<=0){
clearInterval(timer);
currentPhaseIndex++;
}
},1000);
}

function nextPhase(){
clearInterval(timer);
currentPhaseIndex++;
runPhase();
}

// ==========================
// PROGRESSIONE
// ==========================

function completeWorkout(){
if(data.completedDate!==today()){
data.streak++;
}
data.completedDate=today();

workouts[data.lastWorkout].forEach(cat=>{
data.categories[cat].streak++;
if(data.categories[cat].streak>=2){
if(data.categories[cat].time<50){
data.categories[cat].time+=5;
}else{
data.categories[cat].band+=10;
data.categories[cat].time=40;
}
data.categories[cat].streak=0;
}
});

localStorage.setItem("workoutV4",JSON.stringify(data));
renderStatus();
alert("Allenamento salvato e progressione aggiornata");
}

function renderStatus(){
let done=data.completedDate===today()?"âœ” Oggi completato":"";
document.getElementById("status").innerHTML=
done+"<br>ðŸ”¥ Giorni consecutivi: "+data.streak;
}

generateWorkout();

</script>
</body>
</html>
