<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Workout 100</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#111;color:#eee;padding:15px;text-align:center}
button{padding:8px;margin:6px;background:#222;color:#eee;border:1px solid #444}
select{background:#222;color:#eee;border:1px solid #444;padding:5px}
#metro{width:80px;height:80px;margin:20px auto;background:#333}
.phase{margin:10px;font-weight:bold}
.small{font-size:12px;color:#aaa}
.block{margin:10px 0;padding:8px;border:1px solid #333}
</style>
</head>
<body>

<h2>Workout 100</h2>

<div>
Allenamento: <span id="workoutType"></span>
</div>

<div>
<select id="mode">
<option value="25">25 minuti</option>
<option value="35">35 minuti</option>
</select>
</div>

<div id="status"></div>

<div id="session"></div>

<div id="metro"></div>
<div class="phase" id="phaseText"></div>
<div id="timeLeft"></div>

<button onclick="startSession()">Start Sessione</button>
<button onclick="completeWorkout()">Allenamento completato</button>

<script>

let data = JSON.parse(localStorage.getItem("workoutV3")) || {
startDate:new Date().toISOString().split("T")[0],
lastDate:null,
lastWorkout:0,
streak:0,
categories:{
pull:{band:15,time:40,streak:0},
push:{band:15,time:40,streak:0},
posterior:{band:25,time:40,streak:0}
}
};

const workouts={
1:["pull","push","posterior"],
2:["push","posterior","pull"],
3:["posterior","pull","push"]
};

const exerciseDB={
pull:["Band Row","Face Pull","High Row"],
push:["Push-up","Floor Press","Pike Push-up"],
posterior:["Deadlift","Glute Bridge","Good Morning"]
};

function today(){
return new Date().toISOString().split("T")[0];
}

function generateWorkout(){
if(data.lastDate!==today()){
data.lastWorkout = data.lastWorkout%3 +1;
data.lastDate=today();
localStorage.setItem("workoutV3",JSON.stringify(data));
}
document.getElementById("workoutType").innerText=data.lastWorkout;
renderSession();
renderStatus();
}

function renderStatus(){
let completedToday = data.completedDate===today();
document.getElementById("status").innerHTML=
(completedToday?"âœ” Oggi completato":"")+
"<br>ðŸ”¥ Giorni consecutivi: "+data.streak;
}

function renderSession(){
let container=document.getElementById("session");
container.innerHTML="";
workouts[data.lastWorkout].forEach(cat=>{
let ex=exerciseDB[cat][Math.floor(Math.random()*exerciseDB[cat].length)];
container.innerHTML+=`
<div class="block">
<b>${ex}</b><br>
Banda: ${data.categories[cat].band} kg<br>
Tempo lavoro: ${data.categories[cat].time} sec
</div>`;
});
}

let timer;
let currentPhaseIndex=0;
let phases=[];
let metroCounter=0;

function buildPhases(){
let mode=document.getElementById("mode").value;
let total = mode==="25"?1500:2100;
let warm = mode==="25"?90:120;
let mobility = mode==="25"?90:120;
let core = mode==="25"?90:120;
let stretch = mode==="25"?60:90;

let blockTime = (total - warm - mobility - core - stretch)/3;

phases=[
{name:"Riscaldamento",time:warm},
{name:"MobilitÃ ",time:mobility}
];

workouts[data.lastWorkout].forEach(cat=>{
phases.push({name:"Blocco "+cat,time:blockTime});
});

phases.push({name:"Core controllo",time:core});
phases.push({name:"Stretch",time:stretch});
}

function startSession(){
buildPhases();
currentPhaseIndex=0;
runPhase();
}

function runPhase(){
if(currentPhaseIndex>=phases.length){
clearInterval(timer);
document.getElementById("phaseText").innerText="Sessione finita";
return;
}
let phase=phases[currentPhaseIndex];
let timeLeft=phase.time;
document.getElementById("phaseText").innerText=phase.name;
timer=setInterval(()=>{
timeLeft--;
document.getElementById("timeLeft").innerText=timeLeft+" sec";
updateMetronome();
if(timeLeft<=0){
clearInterval(timer);
currentPhaseIndex++;
runPhase();
}
},1000);
}

function updateMetronome(){
metroCounter++;
let metro=document.getElementById("metro");
let cycle=metroCounter%5;
if(cycle===1||cycle===2){
metro.style.background="#0a0";
}else if(cycle===3){
metro.style.background="#06f";
}else{
metro.style.background="#a00";
}
}

function completeWorkout(){
if(data.completedDate!==today()){
if(data.lastDate===today()){
data.streak++;
}else{
data.streak=1;
}
}
data.completedDate=today();

workouts[data.lastWorkout].forEach(cat=>{
data.categories[cat].streak++;
if(data.categories[cat].streak>=2){
if(data.categories[cat].time<50){
data.categories[cat].time+=5;
}else{
data.categories[cat].band+=10;
data.categories[cat].time=40;
}
data.categories[cat].streak=0;
}
});

localStorage.setItem("workoutV3",JSON.stringify(data));
renderStatus();
alert("Salvato e progressione aggiornata");
}

generateWorkout();

</script>
</body>
</html>
