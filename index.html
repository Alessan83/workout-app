<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Workout 100</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#111;color:#eee;padding:10px}
button{padding:8px;margin:4px;background:#222;color:#eee;border:1px solid #444}
select{background:#222;color:#eee;border:1px solid #444;padding:5px}
.exercise{border:1px solid #333;padding:8px;margin:6px 0}
.calendar{display:grid;grid-template-columns:repeat(10,1fr);gap:2px;margin-top:10px}
.day{width:100%;padding-top:100%;position:relative}
.day div{position:absolute;top:0;bottom:0;left:0;right:0;font-size:10px;display:flex;align-items:center;justify-content:center}
.done{background:#064}
.empty{background:#333}
h3{margin-top:20px}
.small{font-size:12px;color:#aaa}
</style>
</head>
<body>

<h2>Workout 100</h2>
<div>Giorno: <span id="dayNumber"></span>/100</div>
<div>Allenamento: <span id="workoutType"></span></div>

<div id="workout"></div>

<button onclick="completeWorkout()">Allenamento completato</button>

<h3>Calendario</h3>
<div id="calendar" class="calendar"></div>

<script>

let data = JSON.parse(localStorage.getItem("workoutData")) || {
    startDate: new Date().toISOString().split("T")[0],
    lastGeneratedDate: null,
    lastWorkoutType: 0,
    sessions: [],
    categories:{
        pull:{band:15,reps:12,streak:0},
        push:{band:15,reps:12,streak:0},
        posterior:{band:25,reps:10,streak:0},
        core:{reps:30,streak:0}
    }
};

const workouts = {
    1:["pull","core","push"],
    2:["push","core","posterior"],
    3:["posterior","core","pull"]
};

const exercises = {
    pull:["Band Row","High Row","Face Pull"],
    push:["Push-up","Floor Press","Pike Push-up"],
    posterior:["Deadlift","Good Morning","Glute Bridge"],
    core:["Plank","Dead Bug","Side Plank"]
};

function getDayNumber(){
    const start=new Date(data.startDate);
    const now=new Date();
    return Math.min(100,Math.floor((now-start)/(1000*60*60*24))+1);
}

document.getElementById("dayNumber").innerText=getDayNumber();

function generateWorkoutIfNeeded(){
    const today=new Date().toISOString().split("T")[0];
    if(data.lastGeneratedDate!==today){
        data.lastWorkoutType = data.lastWorkoutType%3 +1;
        data.todayWorkout = workouts[data.lastWorkoutType];
        data.lastGeneratedDate=today;
        localStorage.setItem("workoutData",JSON.stringify(data));
    }
    document.getElementById("workoutType").innerText=data.lastWorkoutType;
}

function renderWorkout(){
    const container=document.getElementById("workout");
    container.innerHTML="";
    data.todayWorkout.forEach(cat=>{
        const ex=exercises[cat][Math.floor(Math.random()*exercises[cat].length)];
        const div=document.createElement("div");
        div.className="exercise";
        if(cat==="core"){
            div.innerHTML=`
            <b>${ex}</b><br>
            Target: ${data.categories[cat].reps} sec<br>
            RPE:
            <select id="${cat}-rpe">
            <option>Facile</option>
            <option>Medio</option>
            <option>Duro</option>
            </select>
            `;
        }else{
            div.innerHTML=`
            <b>${ex}</b><br>
            Banda consigliata: ${data.categories[cat].band} kg<br>
            Target reps: ${data.categories[cat].reps}<br>
            RPE:
            <select id="${cat}-rpe">
            <option>Facile</option>
            <option>Medio</option>
            <option>Duro</option>
            </select>
            `;
        }
        container.appendChild(div);
    });
}

function completeWorkout(){
    data.sessions.push({date:new Date().toISOString().split("T")[0]});
    data.todayWorkout.forEach(cat=>{
        const rpe=document.getElementById(cat+"-rpe").value;
        if(rpe!=="Duro"){
            data.categories[cat].streak++;
        }else{
            data.categories[cat].streak=0;
        }
        if(data.categories[cat].streak>=2){
            if(cat!=="core"){
                if(data.categories[cat].reps<20){
                    data.categories[cat].reps+=2;
                }else{
                    data.categories[cat].band+=10;
                    data.categories[cat].reps=10;
                }
            }else{
                data.categories[cat].reps+=5;
            }
            data.categories[cat].streak=0;
        }
    });
    localStorage.setItem("workoutData",JSON.stringify(data));
    renderCalendar();
    alert("Salvato e progressione aggiornata");
}

function renderCalendar(){
    const cal=document.getElementById("calendar");
    cal.innerHTML="";
    for(let i=1;i<=100;i++){
        const div=document.createElement("div");
        div.className="day";
        const inner=document.createElement("div");
        if(data.sessions[i-1]){
            inner.className="done";
        }else{
            inner.className="empty";
        }
        div.appendChild(inner);
        cal.appendChild(div);
    }
}

generateWorkoutIfNeeded();
renderWorkout();
renderCalendar();

</script>

</body>
</html>
