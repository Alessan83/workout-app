<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Workout 100</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#111;color:#eee;padding:15px;text-align:center}
button{padding:8px 10px;margin:6px;background:#222;color:#eee;border:1px solid #444;border-radius:6px}
select,input[type="checkbox"]{background:#222;color:#eee;border:1px solid #444;padding:5px;border-radius:6px}
.section{margin:18px 0;font-weight:bold;font-size:16px;display:flex;justify-content:center;align-items:center;gap:8px}
.exercise{border:1px solid #333;padding:10px;margin:8px 0;text-align:left;border-radius:10px;background:#141414}
a{color:#4da6ff;text-decoration:none}
.small{font-size:12px;color:#aaa}
.pill{display:inline-block;border:1px solid #333;padding:4px 8px;margin:4px;background:#151515;border-radius:999px}
.square{width:14px;height:14px;border:1px solid #444;display:inline-block;margin-right:6px;vertical-align:middle;border-radius:3px}
.done{background:#2a7a2a}
hr{border:0;border-top:1px solid #333;margin:14px 0}
.row{display:flex;justify-content:center;align-items:center;gap:10px;flex-wrap:wrap}
.miniCard{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid #333;background:#151515;border-radius:12px}
.badge{display:inline-block;font-size:11px;color:#bbb;border:1px solid #2f2f2f;padding:2px 6px;border-radius:999px;background:#101010}
.sketch{width:38px;height:38px;border:1px solid #2f2f2f;border-radius:10px;background:#101010;display:flex;align-items:center;justify-content:center}
</style>
</head>
<body>

<h2>Workout 100</h2>

<div class="row">
  <span class="miniCard">
    <label>Durata</label>
    <select id="mode" onchange="generateWorkout()">
      <option value="25">25 minuti</option>
      <option value="35">35 minuti</option>
    </select>
  </span>

  <span class="miniCard">
    <label>Giorno corsa</label>
    <input type="checkbox" id="runDay" onchange="generateWorkout()">
  </span>

  <span class="miniCard">
    <label>RPE</label>
    <select id="sessionRPE">
      <option value="1">Facile</option>
      <option value="2" selected>Medio</option>
      <option value="3">Duro</option>
    </select>
  </span>
</div>

<div class="row">
  <span id="doneSquare" class="square"></span>
  <span class="pill">Streak: <span id="streak">0</span></span>
  <span class="pill">Totali: <span id="totalW">0</span></span>
  <span class="pill">Settimana: <span id="cycleW">1</span>/4</span>
</div>

<hr>
<div id="program"></div>
<hr>

<div class="row">
  <span class="pill">Fase: <b id="phase">—</b></span>
  <span class="pill">Tempo: <b id="timeLeft">—</b></span>
</div>

<div class="row">
  <button onclick="startSession()">Start</button>
  <button onclick="nextPhase()">Next</button>
  <button onclick="completeWorkout()">Allenamento completato</button>
</div>

<div class="row">
  <button onclick="exportLog()">Esporta log</button>
</div>

<script>

/* ================= STORAGE ================= */
const STORE="workoutV10";
let data = JSON.parse(localStorage.getItem(STORE)) || {
completedDate:null,
streak:0,
totalWorkouts:0,
bandIndex:0,
baseReps:12,
logs:[]
};
function save(){localStorage.setItem(STORE,JSON.stringify(data));}
function today(){return new Date().toISOString().split("T")[0];}

/* ================= PERIODIZZAZIONE ================= */
const BAND_LEVELS=[15,25,35];

function weekInCycle(){
return Math.floor((data.totalWorkouts % 16)/4)+1;
}

/* ================= STRUTTURA RX BASED ================= */
function structuralBias(){
return{
thoracicFocus:true,
protectLumbar:true,
week:weekInCycle()
};
}

/* ================= DATABASE ================= */
const DB={
warm:["Jumping Jacks","High Knees","Shadow Boxing","Inchworm","Scapular Push-up"],
mob:["Thoracic Rotation","Open Book","Wall Slides","Cat-Cow"],
stretch:["Child Pose","Hip Flexor Stretch","Hamstring Stretch"],
train:[
{name:"Band Row",t:"pull"},
{name:"Band Face Pull",t:"pull"},
{name:"Band Pull-Apart",t:"pull"},
{name:"Push-up",t:"push"},
{name:"Incline Push-up",t:"push"},
{name:"Band Overhead Press",t:"push"},
{name:"Glute Bridge (band)",t:"hinge"},
{name:"Banded RDL",t:"hinge"},
{name:"Monster Walk",t:"hinge"},
{name:"Plank",t:"core"},
{name:"Dead Bug",t:"core"}
]
};

/* ================= RANDOM STABILE ================= */
function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return ((t^t>>>14)>>>0)/4294967296;}}
function seedFromDate(str){let n=0;for(let i=0;i<str.length;i++)n=(n*31+str.charCodeAt(i))>>>0;return n;}

function pickStable(list,count,key){
const rng=mulberry32(seedFromDate(today()+key));
let arr=[...list];
for(let i=arr.length-1;i>0;i--){
const j=Math.floor(rng()*(i+1));
[arr[i],arr[j]]=[arr[j],arr[i]];
}
return arr.slice(0,count);
}

/* ================= CALCOLO PROGRESSIONE ================= */
function calcSuggestion(){
let reps=data.baseReps;
let band=data.bandIndex;
let w=weekInCycle();

if(w===2) reps+=2;
if(w===3) reps+=4;
if(w===4) reps=Math.max(8,reps-4);

return{
band:BAND_LEVELS[band],
reps:reps,
cycles:(document.getElementById("mode").value==="25"?2:3)
};
}

/* ================= RENDER ================= */
function tutorialLink(name){
return "https://www.youtube.com/results?search_query="+encodeURIComponent(name+" exercise tutorial");
}

function renderProgram(){
const container=document.getElementById("program");
container.innerHTML="";
const sug=calcSuggestion();

document.getElementById("cycleW").innerText=weekInCycle();
document.getElementById("streak").innerText=data.streak;
document.getElementById("totalW").innerText=data.totalWorkouts;

container.innerHTML+="<div class='section'>Mobilità / Riscaldamento</div>";
pickStable(DB.warm,3,"warm").forEach(e=>{
container.innerHTML+=`<div class='exercise'><b>${e}</b><div class='small'><a href='${tutorialLink(e)}' target='_blank'>YouTube</a></div></div>`;
});
pickStable(DB.mob,2,"mob").forEach(e=>{
container.innerHTML+=`<div class='exercise'><b>${e}</b><div class='small'><a href='${tutorialLink(e)}' target='_blank'>YouTube</a></div></div>`;
});

container.innerHTML+="<div class='section'>Allenamento</div>";
pickStable(DB.train,7,"train").forEach(e=>{
container.innerHTML+=`<div class='exercise'>
<b>${e.name}</b>
<div class='small'>Banda: ${sug.band}kg | Reps: ${sug.reps} | Cicli: ${sug.cycles}</div>
<div class='small'><a href='${tutorialLink(e.name)}' target='_blank'>YouTube</a></div>
</div>`;
});

container.innerHTML+="<div class='section'>Stretch</div>";
pickStable(DB.stretch,1,"stretch").forEach(e=>{
container.innerHTML+=`<div class='exercise'><b>${e}</b></div>`;
});
}

/* ================= TIMER ================= */
let phases=[],current=0,timer=null,audioCtx=null,gainNode=null;

function initAudio(){
audioCtx=new(window.AudioContext||window.webkitAudioContext)();
gainNode=audioCtx.createGain();
gainNode.gain.value=0.01;
gainNode.connect(audioCtx.destination);
}
function beep(){
if(!audioCtx) initAudio();
const osc=audioCtx.createOscillator();
osc.type="sine";
osc.frequency.value=520;
osc.connect(gainNode);
osc.start();
osc.stop(audioCtx.currentTime+0.04);
}
function buildPhases(){
const total=parseInt(document.getElementById("mode").value)*60;
phases=[
{name:"Warm",time:Math.round(total*0.1),beep:true},
{name:"Train",time:Math.round(total*0.8),beep:false},
{name:"Stretch",time:30,beep:true}
];
}
function startSession(){
buildPhases();current=0;runPhase();
}
function runPhase(){
if(timer)clearInterval(timer);
if(current>=phases.length)return;
let p=phases[current];let t=p.time;
document.getElementById("phase").innerText=p.name;
timer=setInterval(()=>{
t--;document.getElementById("timeLeft").innerText=t+" sec";
if(p.beep)beep();
if(t<=0){clearInterval(timer);current++;runPhase();}
},1000);
}
function nextPhase(){current++;runPhase();}

/* ================= COMPLETE ================= */
function completeWorkout(){
if(data.completedDate===today())return;
data.completedDate=today();
data.totalWorkouts++;
data.streak++;
const rpe=parseInt(document.getElementById("sessionRPE").value);

if(rpe===1 && data.baseReps<18)data.baseReps+=2;
if(rpe===3)data.baseReps=Math.max(8,data.baseReps-2);

data.logs.unshift({date:today(),rpe:rpe});
data.logs=data.logs.slice(0,100);

save();
generateWorkout();
}

/* ================= EXPORT ================= */
function exportLog(){
const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
const url=URL.createObjectURL(blob);
const a=document.createElement("a");
a.href=url;a.download="workout_log.json";
a.click();
}

/* ================= INIT ================= */
function generateWorkout(){
renderProgram();
if(data.completedDate===today())document.getElementById("doneSquare").classList.add("done");
else document.getElementById("doneSquare").classList.remove("done");
}
generateWorkout();

</script>
</body>
</html>
