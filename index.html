<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Workout 100</title>

<style>
:root{
  --bg:#0f1115;
  --panel:#151924;
  --text:#e8e8e8;
  --muted:#8a8f9e;
  --line:#2a3142;
  --accent:#4da6ff;
}

body{
  margin:0;
  padding:12px;
  background:var(--bg);
  color:var(--text);
  font-family:Arial,system-ui;
}

.card{
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:12px;
  padding:12px;
  margin-bottom:14px;
}

h1{margin:0 0 10px 0;}

select,button{
  background:#0b0d12;
  border:1px solid var(--line);
  color:var(--text);
  border-radius:10px;
  padding:8px 10px;
}

button{cursor:pointer}

.exercise{
  border:1px solid var(--line);
  border-radius:10px;
  padding:10px;
  margin-top:8px;
}

.section{
  margin-top:12px;
  font-weight:bold;
  color:var(--accent);
}

.small{
  font-size:12px;
  color:var(--muted);
}

.videoBtn{
  float:right;
  font-size:12px;
  padding:4px 8px;
}
</style>
</head>
<body>

<h1>Workout 100</h1>

<div class="card">
  Durata:
  <select id="duration">
    <option value="25">25 minuti</option>
    <option value="35">35 minuti</option>
  </select>

  RPE finale:
  <select id="rpe">
    <option value="1">1 = facile</option>
    <option value="2" selected>2 = ok</option>
    <option value="3">3 = duro</option>
  </select>

  <button onclick="generateSession()">Genera sessione</button>
  <button onclick="completeSession()">Allenamento completato</button>

  <div class="small" id="statusLine"></div>
</div>

<div class="card">
  <div id="sessionOutput"></div>
</div>

<!-- ENGINES -->
<script src="trainingKnowledge.js"></script>
<script src="equipmentEngine.js"></script>
<script src="studyEngine.js"></script>
<script src="biomechanicalEngine.js"></script>
<script src="sessionengine1.js"></script>
<script src="workoutCoordinator.js"></script>

<script>
let exerciseDB = null;
let currentSession = null;

function today(){
  return new Date().toISOString().split("T")[0];
}

async function loadDB(){
  try{
    const res = await fetch("exercises.json",{cache:"no-store"});
    exerciseDB = await res.json();
    document.getElementById("statusLine").innerText = "DB caricato ✓";
  }catch(e){
    document.getElementById("statusLine").innerText = "Errore DB ❌";
    console.error(e);
  }
}

function enginesStatus(){
  const s = typeof StudyEngine !== "undefined";
  const b = typeof BiomechanicalEngine !== "undefined";
  const se = typeof SessionEngine !== "undefined";
  return `Motori: Study(${s?"OK":"NO"}) • Bio(${b?"OK":"NO"}) • Session(${se?"OK":"NO"})`;
}

function generateSession(){
  if(!exerciseDB){
    alert("DB non caricato");
    return;
  }

  if(typeof SessionEngine !== "object"){
    alert("SessionEngine non caricato");
    return;
  }

  const minutes = parseInt(document.getElementById("duration").value);

  currentSession = SessionEngine.generateSession(
    exerciseDB,
    {
      sessionMinutes:minutes,
      runDay:false,
      fasting:false
    }
  );

  renderSession();
}

function renderSession(){
  const container = document.getElementById("sessionOutput");
  container.innerHTML = "";

  if(!currentSession){
    container.innerHTML = "<div class='small'>Nessuna sessione generata</div>";
    return;
  }

  renderSection("Riscaldamento", currentSession.warm);
  renderSection("Mobilità", currentSession.mobility);
  renderSection("Forza", currentSession.strength);
}

function renderSection(title,list){
  const container = document.getElementById("sessionOutput");
  container.innerHTML += `<div class="section">${title}</div>`;

  if(!list || list.length===0){
    container.innerHTML += "<div class='small'>—</div>";
    return;
  }

  list.forEach(ex=>{
    const name = ex.name || ex;
    const band = ex.band ? ` | Banda: ${ex.band}` : "";
    const cycles = ex.cycles ? ` | Cicli: ${ex.cycles}` : "";
    const reps = ex.reps ? ` | Reps: ${ex.reps}` : "";

    const videoLink = "https://www.youtube.com/results?search_query="+encodeURIComponent(name+" esercizio elastici");

    container.innerHTML += `
      <div class="exercise">
        <button class="videoBtn" onclick="window.open('${videoLink}','_blank')">Video</button>
        <b>${name}</b>
        <div class="small">
          ${band}${cycles}${reps}
        </div>
      </div>
    `;
  });
}

function completeSession(){
  if(!currentSession){
    alert("Nessuna sessione generata");
    return;
  }

  const rpe = parseInt(document.getElementById("rpe").value);

  if(typeof StudyEngine === "object" && StudyEngine.completeSession){
    StudyEngine.completeSession(currentSession,rpe);
  }

  if(typeof BiomechanicalEngine === "object" && BiomechanicalEngine.completeSession){
    BiomechanicalEngine.completeSession(currentSession,rpe);
  }

  if(typeof SessionEngine === "object" && SessionEngine.completeSession){
    SessionEngine.completeSession(currentSession,rpe);
  }

  alert("Sessione salvata");
}

window.addEventListener("DOMContentLoaded",()=>{
  loadDB();
  document.getElementById("statusLine").innerText = enginesStatus();
});
</script>

</body>
</html>
